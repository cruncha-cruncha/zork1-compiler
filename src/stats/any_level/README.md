The code in here is a complete mess, I'm sorry.

And the error response text really needs word. Sometimes it's good, sometimes it's very misleading.
